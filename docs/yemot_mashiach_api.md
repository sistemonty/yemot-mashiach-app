# ימות המשיח - תיעוד API

## תוכן עניינים
1. [מודול API - תקשורת דו צדדית](#מודול-api---תקשורת-דו-צדדית)
2. [פניית API של ימות המשיח](#פניית-api-של-ימות-המשיח)

## מודול API - תקשורת דו צדדית

מודול זה מאפשר תקשורת דו כיוונית בין המערכת הטלפונית לשרת חיצוני. המערכת מעדכנת את השרת בנתונים שהתקבלו, והשרת שולח הוראות למערכת מה לבצע עם השיחה.

### הגדרות כלליות

#### הגדרת סוג שלוחה
```
type=api
```

#### הגדרת כתובת URL
```
api_link=https://your-server.com/api-endpoint
```

#### שיטת שליחה
ברירת המחדל היא GET. לשימוש ב-POST:
```
api_url_post=yes
```

### שליחת נתונים לשרת

הפרמטרים הנשלחים בכל בקשה:
- `ApiId` - מזהה ייחודי של הפנייה
- `ApiTime` - זמן הפנייה
- `ApiPhone` - מספר הטלפון של המתקשר
- `ApiFolder` - מספר השלוחה הנוכחית
- `ApiKey` - מפתח API (אם הוגדר)
- `ApiInput` - קלט המשתמש (אם קיים)

### תשובות מהשרת

#### פקודות אפשריות:
1. `go_to_folder=/path` - מעבר לשלוחה
2. `play_file=filename` - השמעת קובץ
3. `read=text` - הקראת טקסט
4. `hang_up` - ניתוק השיחה
5. `api_log_no` - ביטול רישום לוג לפעולה ספציפית

#### דוגמה לתשובה:
```
play_file=welcome&go_to_folder=/1/2
```

### לוגים

#### הגדרת לוגים
לביטול שמירת לוגים:
```
api_log=no
```

#### מיקום הלוגים
הלוגים נשמרים בקובץ `LogApi.ymgr` בתיקיית `Log`

#### פורמט הלוגים
- ApiSend: מחליף `=` ב-`^` ו-`&` ב-`*`
- ApiAnswer: מחליף `,` ב-`^` ו-`&` ב-`*`

## דניית API של ימות המשיח

פניית API מאפשרת גישה למערכת ימות המשיח מבחוץ. באמצעות פניות אלו ניתן לבצע פעולות שונות במערכת.

### נקודת הקצה
```
https://f2.freeivr.co.il/api/v1/
```

### פרמטרים נדרשים בכל פנייה
- `ApiKey` - מפתח API שקיבלתם מהמערכת
- `ApiAction` - סוג הפעולה המבוקשת

### פעולות אפשריות

#### יצירת שיחה יוצאת
```
ApiAction=MakeCall
phone=0501234567
folder=/1/2
```

#### בדיקת סטטוס שיחה
```
ApiAction=CallStatus
call_id=123456
```

#### קבלת היסטוריית שיחות
```
ApiAction=CallHistory
from_date=2024-01-01
to_date=2024-01-31
```

### דוגמה לתשובה מהשרת
```json
{
    "status": "success",
    "data": {
        "call_id": "123456",
        "status": "connected",
        "duration": 45
    }
}
```

### קודי שגיאה נפוצים
- `401` - מפתח API לא תקין
- `403` - אין הרשאה לפעולה המבוקשת
- `404` - המשאב המבוקש לא נמצא
- `429` - חריגה ממכסת הפניות 